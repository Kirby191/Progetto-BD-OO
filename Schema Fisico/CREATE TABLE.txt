CREATE TABLE Nazione(
Nome VARCHAR(50),
PRIMARY KEY (Nome));

CREATE TABLE Giocatore (
Nome VARCHAR(50) NOT NULL,
Cognome VARCHAR(50) NOT NULL,
SSN ssn_valido NOT NULL,
Nazionalità VARCHAR(50) REFERENCES Nazione(Nome) NOT NULL,
DataDiNascita eta_valida NOT NULL,
Sesso sesso_corretto NOT NULL,
Piede CHARACTER(1) NOT NULL,
Altezza NUMERIC(3,0) NOT NULL,
Peso NUMERIC(4,0) NOT NULL,
Ruoli RuoloType NOT NULL,
Ritirato BOOLEAN NOT NULL,
Abilità VARCHAR(50) NOT NULL,
TipoGiocatore CHARACTER(1) NOT NULL,

PRIMARY KEY (SSN),

CONSTRAINT AltezzaCorretta CHECK(Altezza > 1.50),
CONSTRAINT PesoCorretto CHECK(Peso > 40.00),
CONSTRAINT PiedeCorretto CHECK(Piede = 'D' or Piede = 'S'),
CONSTRAINT TipoGiocatoreCorretto CHECK(TipoGiocatore= 'M' or TipoGiocatore= 'P')
);


CREATE TABLE Militanza(
ID_Militanza SERIAL NOT NULL,
Data_Inizio DATE NOT NULL,
Data_Fine DATE,
PartiteGiocate intero_non_negativo NOT NULL,
GoalSegnati intero_non_negativo NOT NULL,
GoalSubiti intero_non_negativo NOT NULL,
CartelliniGialli intero_non_negativo NOT NULL,
CartelliniRossi intero_non_negativo NOT NULL,
Assist intero_non_negativo NOT NULL,
TipoMilitanza CHAR(1) NOT NULL,

PRIMARY KEY (ID_Militanza),

CONSTRAINT TipoMilitanzacorretto CHECK(TipoMilitanza ='M' or TipoMilitanza ='P')
CONSTRAINT contr_data CHECK (Data_Inizio < Data_Fine));

CREATE TABLE Squadra(
Nome_Squadra VARCHAR(50) UNIQUE NOT NULL,
Nazionalità VARCHAR(50) REFERENCES Nazione(Nome) NOT NULL,
Data_Fondazione DATE NOT NULL,

PRIMARY KEY (Nome_Squadra));

CREATE TABLE Trofeo(
NomeTrofeo VARCHAR(30) NOT NULL,
Anno DATE NOT NULL,
Squadra BOOLEAN NOT NULL,

PRIMARY KEY (NomeTrofeo, Anno));

CREATE TABLE Allenatore(
Nome VARCHAR(50) NOT NULL,
Cognome VARCHAR(50) NOT NULL,
Sesso sesso_corretto NOT NULL,
SSN ssn_valido NOT NULL,
InizioA DATE NOT NULL,
FineA DATE,

PRIMARY KEY (SSN),

CONSTRAINT SuperSSN FOREIGN KEY (SSN) REFERENCES Giocatore(SSN)
ON UPDATE RESTRICT
ON DELETE RESTRICT);

CREATE TABLE Dirigente(
Nome VARCHAR(50) NOT NULL,
Cognome VARCHAR(50) NOT NULL,
Sesso sesso_corretto NOT NULL,
SSN ssn_valido NOT NULL,
RuoloDirigente ruoloDirigente NOT NULL,
InizioD DATE NOT NULL,
FineD DATE,

PRIMARY KEY (SSN));

CREATE TABLE Riferisce(
ID_Militanza SERIAL REFERENCES Militanza(ID_Militanza) UNIQUE NOT NULL,
NomeSquadra VARCHAR(50) REFERENCES Squadra(Nome_Squadra) NOT NULL);

CREATE TABLE Vincere (
    SSN ssn_valido REFERENCES Giocatore(SSN) NOT NULL,
    NomeTrofeo VARCHAR(30) NOT NULL,
    Anno DATE NOT NULL,
	
    CONSTRAINT TrofeoFK FOREIGN KEY (NomeTrofeo, Anno) REFERENCES Trofeo(NomeTrofeo, Anno));

CREATE TABLE Partecipa_In(
SSN ssn_valido REFERENCES Giocatore(SSN) NOT NULL,
NomeSquadra VARCHAR(50) REFERENCES Squadra(Nome_Squadra) NOT NULL);

CREATE TABLE Ottenuto_Da(
NomeSquadra VARCHAR(50) REFERENCES Squadra(Nome_Squadra) NOT NULL,
    NomeTrofeo VARCHAR(30) NOT NULL,
    Anno DATE NOT NULL,
	
    CONSTRAINT TrofeoFK FOREIGN KEY (NomeTrofeo, Anno) REFERENCES Trofeo(NomeTrofeo, Anno));

CREATE TABLE Dirige(
SSN_Dirigente ssn_valido REFERENCES Dirigente(SSN) NOT NULL,
NomeSquadra VARCHAR(50) REFERENCES Squadra(Nome_Squadra) NOT NULL);
