//prima di inserire una tupla in dirige dobbiamo controllare che il dirigente non si sia ritirato
// Vittorio: Funziona, se ho modificato è solamente perchè nella exception volevo dirigente con la D maiuscola <3

CREATE OR REPLACE FUNCTION CheckDIsNotRetired()
RETURNS TRIGGER AS $$
BEGIN 
	IF((SELECT FineD
	    FROM Dirigente
	    WHERE SSN = New.SSN_Dirigente) IS NOT NULL) THEN 
		RAISE EXCEPTION 'Il Dirigente non può essere inserito perchè si è ritirato';
	END IF;
	RETURN NEW;
END;
$$ Language plpgsql;

CREATE TRIGGER check_d_is_not_retired
BEFORE INSERT ON Dirige
FOR EACH ROW
EXECUTE FUNCTION CheckDIsNotRetired();
